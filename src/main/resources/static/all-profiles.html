<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>V≈°echny profily</title>
  <style>
    body{
      background-color: #607B8B;
    }
    .user-section {
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid black;
      border-radius: 5px;
      background-color: #C0C0C0;
    }
    .user-email {
      font-weight: bold;
      color: #CD2990;
      margin-bottom: 5px;
    }

    .navigation {
      margin-top: 20px;
      display: flex;
      gap: 15px;
    }
    .navigation a {
      text-decoration: none;
      color: black;
      margin-right: 15px;
      padding: 5px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: white;
    }
    .navigation a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
<h2>V≈°echny profily u≈æivatel≈Ø</h2>
<div id="all-profiles-container">
  <p>Naƒç√≠t√°n√≠ profil≈Ø...</p>
</div>

<div class="navigation">
  <a href="/dashboard.html">‚¨Ö Zpƒõt na √∫koly</a>
  <a href="/profile.html">üë§ M≈Øj profil</a>
</div>

<script>
  fetch('/api/email')
          .then(res => res.text())
          .then(email => {
            if (email === "Nep≈ôihl√°≈°en") {
              window.location.href = "/login.html";
              return;
            }

            return fetch('/api/all-profiles');
          })
          .then(res => res.json())
          .then(userProfiles => {
            const container = document.getElementById('all-profiles-container');
            container.innerHTML = '';

            if (Object.keys(userProfiles).length === 0) {
              container.innerHTML = '<p>Zat√≠m nejsou k dispozici ≈æ√°dn√© √∫daje.</p>';
              return;
            }

            const sortedUsers = Object.keys(userProfiles).sort();

            sortedUsers.forEach(email => {
              const tasks = userProfiles[email];

              const userSection = document.createElement('div');
              userSection.className = 'user-section';

              const userEmail = document.createElement('div');
              userEmail.className = 'user-email';
              userEmail.textContent = email;
              userSection.appendChild(userEmail);

              if (tasks.length === 0) {
                const noTasks = document.createElement('p');
                noTasks.textContent = '≈Ω√°dn√© splnƒõn√© √∫koly';
                userSection.appendChild(noTasks);
              } else {
                const tasksList = document.createElement('ul');
                tasks.forEach(task => {
                  const taskItem = document.createElement('li');
                  taskItem.textContent = task;
                  tasksList.appendChild(taskItem);
                });
                userSection.appendChild(tasksList);
              }

              container.appendChild(userSection);
            });
          })
          .catch(error => {
            console.error("Error loading profiles data:", error);
            document.getElementById('all-profiles-container').innerHTML =
                    '<p style="color: red;">Chyba p≈ôi naƒç√≠t√°n√≠ dat: ' + error.message + '</p>';
          });
</script>
</body>
</html>

